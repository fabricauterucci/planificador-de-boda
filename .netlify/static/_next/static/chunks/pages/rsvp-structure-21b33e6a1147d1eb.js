(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{2043:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>c});var s=a(7876),l=a(4232),t=a(9099),i=a(806),d=a(8230),n=a.n(d),o=a(2982);function c(){let{role:e}=(0,i.A)(),r=(0,t.useRouter)(),[a,d]=(0,l.useState)(!0),[c,u]=(0,l.useState)(null),[h,m]=(0,l.useState)({}),[x,p]=(0,l.useState)({asistencia:"asistire",menu:"Men\xfa Test Manual",comentario:"Test manual"}),[b,N]=(0,l.useState)(null);async function j(){d(!0),u(null);try{let{data:{user:e}}=await o.N.auth.getUser();if(!e)throw Error("No hay usuario autenticado");let r=await fetch("/api/rsvp-structure",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:x,userId:e.id})}),a=await r.json();if(!r.ok)throw Error(a.error||"Error al crear registro de prueba");N(a);let s=await fetch("/api/rsvp-structure"),l=await s.json();if(!s.ok)throw Error("Error al actualizar informaci\xf3n de tabla");m(l)}catch(e){console.error("Error:",e),u(e.message)}finally{d(!1)}}async function g(){d(!0),u(null);try{if("admin"!==e){u("Solo los administradores pueden ejecutar este comando"),d(!1);return}let{error:r}=await o.N.rpc("execute_sql",{sql_query:"\n          ALTER TABLE public.rsvp \n          ALTER COLUMN asistencia TYPE text,\n          DROP CONSTRAINT IF EXISTS rsvp_asistencia_check,\n          ADD CONSTRAINT rsvp_asistencia_check CHECK (asistencia IN ('asistire', 'no_puedo_ir'));\n        "});if(r)throw r;let a=await fetch("/api/rsvp-structure"),s=await a.json();if(!a.ok)throw Error("Error al actualizar informaci\xf3n de tabla");m(s),alert("Estructura de tabla corregida exitosamente")}catch(e){console.error("Error al corregir tipos de columnas:",e),u(e.message||"Error desconocido")}finally{d(!1)}}return((0,l.useEffect)(()=>{"admin"!==e&&"prometidos"!==e&&r.push("/login")},[e,r]),(0,l.useEffect)(()=>{async function r(){d(!0);try{let e=await fetch("/api/rsvp-structure"),r=await e.json();if(!e.ok)throw Error(r.error||"Error al obtener informaci\xf3n de la tabla");m(r)}catch(e){console.error("Error:",e),u(e.message)}finally{d(!1)}}("admin"===e||"prometidos"===e)&&r()},[e]),"admin"!==e&&"prometidos"!==e)?(0,s.jsx)("div",{className:"p-8",children:"Redirigiendo a login..."}):(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Estructura de Tabla RSVP"}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(n(),{href:"/admin/dashboard",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Volver al Dashboard"})}),c&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:c}),a?(0,s.jsx)("div",{className:"text-center py-8",children:"Cargando informaci\xf3n..."}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Estructura de la Tabla"}),h.tableStructure&&h.tableStructure.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full bg-white border",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-200",children:[(0,s.jsx)("th",{className:"py-2 px-4 border",children:"Columna"}),(0,s.jsx)("th",{className:"py-2 px-4 border",children:"Tipo"}),(0,s.jsx)("th",{className:"py-2 px-4 border",children:"Nullable"}),(0,s.jsx)("th",{className:"py-2 px-4 border",children:"Default"})]})}),(0,s.jsx)("tbody",{children:h.tableStructure.map((e,r)=>(0,s.jsxs)("tr",{className:r%2==0?"bg-gray-50":"",children:[(0,s.jsx)("td",{className:"py-2 px-4 border font-medium",children:e.column_name}),(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.data_type}),(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.is_nullable}),(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.column_default||"-"})]},r))})]})}):(0,s.jsx)("p",{className:"text-red-600",children:"No se pudo obtener la estructura de la tabla"}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{onClick:g,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700",disabled:a,children:"Corregir Tipos de Columna"})})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Datos de Muestra"}),h.sampleRecords&&h.sampleRecords.length>0?(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full bg-white border",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"bg-gray-200",children:[(0,s.jsx)("th",{className:"py-2 px-4 border",children:"ID"}),(0,s.jsx)("th",{className:"py-2 px-4 border",children:"User ID"}),(0,s.jsx)("th",{className:"py-2 px-4 border",children:"Asistencia"}),(0,s.jsx)("th",{className:"py-2 px-4 border",children:"Men\xfa"}),(0,s.jsx)("th",{className:"py-2 px-4 border",children:"Comentario"})]})}),(0,s.jsx)("tbody",{children:h.sampleRecords.map((e,r)=>(0,s.jsxs)("tr",{className:r%2==0?"bg-gray-50":"",children:[(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.id}),(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.user_id}),(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.asistencia}),(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.menu||"-"}),(0,s.jsx)("td",{className:"py-2 px-4 border",children:e.comentario||"-"})]},r))})]})}):(0,s.jsx)("p",{className:"text-yellow-600",children:"No hay registros en la tabla"})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Crear Registro de Prueba"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block mb-1 font-medium",children:"Asistencia"}),(0,s.jsxs)("select",{className:"w-full p-2 border rounded",value:x.asistencia,onChange:e=>p({...x,asistencia:e.target.value}),children:[(0,s.jsx)("option",{value:"asistire",children:"asistire"}),(0,s.jsx)("option",{value:"no_puedo_ir",children:"no_puedo_ir"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block mb-1 font-medium",children:"Men\xfa"}),(0,s.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:x.menu,onChange:e=>p({...x,menu:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block mb-1 font-medium",children:"Comentario"}),(0,s.jsx)("input",{type:"text",className:"w-full p-2 border rounded",value:x.comentario,onChange:e=>p({...x,comentario:e.target.value})})]})]}),(0,s.jsx)("button",{onClick:j,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",disabled:a,children:a?"Procesando...":"Crear RSVP de Prueba"}),b&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 rounded",children:[(0,s.jsx)("h3",{className:"font-bold mb-2",children:"Resultado:"}),(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:JSON.stringify(b,null,2)})]})]})]})]})}},5106:(e,r,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/rsvp-structure",function(){return a(2043)}])},9099:(e,r,a)=>{e.exports=a(6296)}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=5106)),_N_E=e.O()}]);