(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[126],{438:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>c});var a=s(7876),t=s(4232),l=s(2982),i=s(806),d=s(7896),n=s(8230),o=s.n(n);function c(){let{role:e,authLoading:r}=(0,i.A)(),[s,n]=(0,t.useState)(""),[c,m]=(0,t.useState)(""),[u,x]=(0,t.useState)(""),[h,p]=(0,t.useState)("idle"),[b,g]=(0,t.useState)(""),[f,j]=(0,t.useState)([]);async function N(e){e.preventDefault(),p("loading"),g("Creando cuenta de administrador...");try{let{data:e,error:r}=await l.N.auth.signUp({email:s,password:c,options:{data:{name:u,role:"admin"}}});if(r)throw r;if(!e.user)throw Error("No se pudo crear el usuario");let{error:a}=await l.N.from("users").insert({id:e.user.id,nombre:u,rol:"admin",email:s});a&&(console.warn("Error al insertar en tabla users:",a),g("Usuario creado en Auth pero hubo un problema al insertar en la tabla users. Puedes arreglar esto despu\xe9s.")),p("success"),g("\xa1Usuario administrador creado exitosamente! ID: ".concat(e.user.id)),n(""),m(""),x("")}catch(e){p("error"),g("Error: ".concat(e.message)),console.error("Error completo:",e)}}return(0,t.useEffect)(()=>{!async function(){try{let{data:e,error:r}=await l.N.auth.admin.listUsers();if(r)throw r;j(e.users||[])}catch(e){console.log("No se pudo usar admin API, intentando consulta normal");try{let{data:e,error:r}=await l.N.from("users").select("*");if(r)throw r;j(e||[])}catch(e){console.error("Error al cargar usuarios:",e)}}}()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{}),(0,a.jsxs)("main",{className:"pt-24 max-w-4xl mx-auto p-4",children:[(0,a.jsx)("h1",{className:"font-display text-2xl mb-6",children:"Crear Usuario Administrador"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Crear nuevo administrador"}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nombre:"}),(0,a.jsx)("input",{type:"text",value:u,onChange:e=>x(e.target.value),className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Email:"}),(0,a.jsx)("input",{type:"email",value:s,onChange:e=>n(e.target.value),className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Contrase\xf1a:"}),(0,a.jsx)("input",{type:"password",value:c,onChange:e=>m(e.target.value),className:"w-full p-2 border rounded",required:!0})]}),(0,a.jsx)("button",{type:"submit",disabled:"loading"===h,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"loading"===h?"Creando...":"Crear Administrador"}),"success"===h&&(0,a.jsx)("div",{className:"p-2 bg-green-100 border border-green-300 rounded text-green-700",children:b}),"error"===h&&(0,a.jsx)("div",{className:"p-2 bg-red-100 border border-red-300 rounded text-red-700",children:b})]})]}),(0,a.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Usuarios Existentes"}),f.length>0?(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"p-2 text-left",children:"Nombre/Email"}),(0,a.jsx)("th",{className:"p-2 text-left",children:"Rol"})]})}),(0,a.jsx)("tbody",{children:f.map(e=>{var r,s;return(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsxs)("td",{className:"p-2",children:[(null==(r=e.user_metadata)?void 0:r.name)||e.nombre||"Sin nombre",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:e.email})]}),(0,a.jsx)("td",{className:"p-2",children:(null==(s=e.user_metadata)?void 0:s.role)||e.rol||"Sin rol"})]},e.id)})})]})}):(0,a.jsx)("p",{children:"No se encontraron usuarios"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(o(),{href:"/admin/fix-policies",className:"text-blue-600 underline",children:"Arreglar pol\xedticas de seguridad"})})]})]}),(0,a.jsxs)("div",{className:"mt-8 p-4 bg-white rounded-lg shadow",children:[(0,a.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Informaci\xf3n adicional"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{children:"Para resolver el problema de la recursi\xf3n infinita en las pol\xedticas de seguridad:"}),(0,a.jsxs)("ol",{className:"list-decimal ml-6 space-y-2",children:[(0,a.jsxs)("li",{children:["Ve a la p\xe1gina ",(0,a.jsx)(o(),{href:"/admin/fix-policies",className:"text-blue-600 underline",children:"Arreglar Pol\xedticas"})]}),(0,a.jsx)("li",{children:"Sigue las instrucciones para aplicar el script SQL"}),(0,a.jsx)("li",{children:"Una vez aplicado, podr\xe1s gestionar usuarios sin problemas"})]}),(0,a.jsx)("p",{children:"Si necesitas configurar tu usuario actual como administrador:"}),(0,a.jsxs)("ol",{className:"list-decimal ml-6 space-y-2",children:[(0,a.jsxs)("li",{children:["Ve a la p\xe1gina ",(0,a.jsx)(o(),{href:"/fix-admin",className:"text-blue-600 underline",children:"Arreglar Rol Admin"})]}),(0,a.jsx)("li",{children:'Haz clic en "Configurar como Admin"'}),(0,a.jsx)("li",{children:"Cierra sesi\xf3n y vuelve a iniciarla"})]})]})]})]})]})}},7896:(e,r,s)=>{"use strict";s.d(r,{A:()=>n});var a=s(7876),t=s(8230),l=s.n(t),i=s(806),d=s(4232);function n(){let{token:e,role:r,authLoading:s,logout:t}=(0,i.A)(),[n,o]=(0,d.useState)("");return(0,d.useEffect)(()=>{{o(localStorage.getItem("name")||"");let e=()=>o(localStorage.getItem("name")||"");return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}},[]),(0,d.useEffect)(()=>{o(localStorage.getItem("name")||"")},[e]),(0,a.jsx)("header",{className:"fixed top-0 inset-x-0 z-50",children:(0,a.jsxs)("nav",{className:"mx-auto max-w-6xl flex items-center justify-between p-4 md:p-6",children:[(0,a.jsx)(l(),{href:"/",className:"font-display text-xl md:text-2xl",children:"Sof\xeda & Franco"}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 md:gap-4 items-center min-w-[140px] w-auto flex-nowrap",children:[!s&&"admin"!==r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l(),{href:"/rsvp",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-dusk text-white hover:opacity-90 text-sm md:text-base text-center",children:"Confirmar asistencia"}),(0,a.jsx)(l(),{href:"/menu",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-gold text-dusk hover:opacity-90 text-sm md:text-base text-center",children:"Men\xfa"})]}),!s&&("admin"===r||"admin@boda.com"===localStorage.getItem("email"))&&(0,a.jsx)(l(),{href:"/admin/dashboard",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-blue-700 text-white hover:opacity-90 text-sm md:text-base text-center",children:"Panel de control"}),!s&&e?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-dusk text-sm font-semibold truncate max-w-[100px]",title:n||r||"Usuario",children:n||r||"Usuario"}),(0,a.jsx)("button",{onClick:t,className:"px-2 py-1 rounded-full bg-blush text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Cerrar sesi\xf3n"}),("admin"===r||"prometidos"===r||"prometido"===r)&&(0,a.jsx)(l(),{href:"/debug",className:"px-2 py-1 rounded-full bg-gray-200 text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Debug"})]}):(0,a.jsx)(l(),{href:"/login",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-white border border-dusk/20 hover:bg-blush text-sm md:text-base text-center",children:"Login"})]})]})})}},9436:(e,r,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/create-admin",function(){return s(438)}])}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=9436)),_N_E=e.O()}]);