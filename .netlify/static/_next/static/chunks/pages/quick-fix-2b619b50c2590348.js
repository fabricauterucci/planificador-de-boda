(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51],{2535:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>d});var s=r(7876),l=r(4232),i=r(2982),n=r(9099),o=r(8230),t=r.n(o);function d(){let e=(0,n.useRouter)(),[a,r]=(0,l.useState)(!0),[o,d]=(0,l.useState)(null),[c,u]=(0,l.useState)(!1);async function m(){if(null==o?void 0:o.id){u(!0);try{try{let{error:a}=await i.N.from("users").update({rol:"admin"}).eq("id",o.id);if(!a){localStorage.setItem("role","admin"),alert("\xa1Rol actualizado con \xe9xito! Refrescando..."),e.reload();return}}catch(e){console.error("Error con m\xe9todo 1:",e)}try{let a=await fetch("/api/make-admin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:o.id})});if((await a.json()).success){localStorage.setItem("role","admin"),alert("\xa1Rol actualizado con \xe9xito v\xeda API! Refrescando..."),e.reload();return}}catch(e){console.error("Error con m\xe9todo 2:",e)}alert("No se pudo actualizar el rol. Por favor, usa el script SQL en la p\xe1gina /admin/check")}catch(e){console.error("Error general:",e),alert("Error actualizando rol. Consulta la consola para m\xe1s detalles.")}finally{u(!1)}}}return((0,l.useEffect)(()=>{!async function(){r(!0);try{let{data:{session:e}}=await i.N.auth.getSession(),{data:{user:a}}=await i.N.auth.getUser();if(!e||!a)return void r(!1);let{data:s}=await i.N.from("users").select("*").eq("id",a.id).single();d({id:a.id,email:a.email,inDatabase:!!s,role:(null==s?void 0:s.rol)||null})}catch(e){console.error("Error verificando usuario:",e)}finally{r(!1)}}()},[]),a)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin h-10 w-10 border-4 border-blue-600 border-t-transparent rounded-full"})}):o?(0,s.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-md p-6 bg-white rounded-lg shadow-lg",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Soluci\xf3n R\xe1pida de Permisos"}),(0,s.jsxs)("div",{className:"mb-6 p-4 bg-gray-100 rounded-lg",children:[(0,s.jsx)("h2",{className:"font-bold mb-2",children:"Informaci\xf3n de Usuario:"}),(0,s.jsxs)("p",{children:["Email: ",(0,s.jsx)("span",{className:"font-semibold",children:o.email})]}),(0,s.jsxs)("p",{children:["ID: ",(0,s.jsx)("span",{className:"text-xs font-mono",children:o.id})]}),(0,s.jsxs)("p",{children:["En Base de Datos: ",o.inDatabase?"✅":"❌"]}),(0,s.jsxs)("p",{children:["Rol Actual: ",(0,s.jsx)("span",{className:"font-semibold",children:o.role||"No definido"})]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"font-bold mb-2",children:"Problema:"}),(0,s.jsx)("p",{children:'Si tienes problemas para acceder al panel de administraci\xf3n aunque ya tienes el rol "admin", puede haber una desincronizaci\xf3n entre la base de datos y tu sesi\xf3n local.'})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("button",{onClick:m,disabled:c,className:"w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:bg-blue-400",children:c?"Aplicando soluci\xf3n...":"Solucionar Permisos Admin"}),(0,s.jsx)(t(),{href:"/role-debug",className:"block w-full py-2 bg-green-600 text-white rounded hover:bg-green-700 text-center",children:"Depuraci\xf3n Avanzada"}),(0,s.jsx)(t(),{href:"/admin/dashboard",className:"block w-full py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-center",children:"Ir al Dashboard"}),(0,s.jsx)("button",{onClick:()=>{localStorage.clear(),i.N.auth.signOut(),alert("Sesi\xf3n cerrada y datos locales eliminados. Ser\xe1s redirigido al login."),e.push("/login")},className:"w-full py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Cerrar Sesi\xf3n y Limpiar Datos"})]})]})}):(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center p-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"No has iniciado sesi\xf3n"}),(0,s.jsx)("p",{className:"mb-4",children:"Debes iniciar sesi\xf3n para usar esta herramienta."}),(0,s.jsx)(t(),{href:"/login",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Ir al Login"})]})}},3616:(e,a,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/quick-fix",function(){return r(2535)}])},9099:(e,a,r)=>{e.exports=r(6296)}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=3616)),_N_E=e.O()}]);