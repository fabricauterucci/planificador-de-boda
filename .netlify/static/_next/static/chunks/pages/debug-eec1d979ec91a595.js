(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[229],{5249:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>x});var t=r(7876),a=r(4232),l=r(806),d=r(2982),n=r(7896),i=r(8230),o=r.n(i),c=r(9099);function x(){let e=(0,c.useRouter)(),{token:s,role:r,authLoading:i}=(0,l.A)(),[x,h]=(0,a.useState)({}),[m,u]=(0,a.useState)(null),[p,g]=(0,a.useState)(null),[f,b]=(0,a.useState)(!0);async function j(){if(m)try{let{data:e}=await d.N.from("users").select("rol").eq("id",m.id).single();e&&e.rol?(localStorage.setItem("role",e.rol),alert("Rol actualizado a: ".concat(e.rol,". Refresca la p\xe1gina para ver los cambios.")),window.location.reload()):alert("No se encontr\xf3 un perfil con un rol definido")}catch(e){console.error("Error al actualizar rol:",e),alert("Error al actualizar rol")}}return(0,a.useEffect)(()=>{if(!i){let t="admin"===r||"prometidos"===r||"prometido"===r;s&&t||e.push("/")}},[i,s,r,e]),(0,a.useEffect)(()=>{let e={};for(let s=0;s<localStorage.length;s++){let r=localStorage.key(s);r&&(e[r]=localStorage.getItem(r)||"")}h(e),async function(){try{let{data:e}=await d.N.auth.getUser();if(u(e.user),e.user){let{data:s}=await d.N.from("users").select("*").eq("id",e.user.id).single();g(s)}}catch(e){console.error("Error fetching user data:",e)}finally{b(!1)}}()},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.A,{}),(0,t.jsxs)("main",{className:"pt-24 max-w-4xl mx-auto p-4",children:[(0,t.jsx)("h1",{className:"font-display text-2xl mb-6",children:"Depuraci\xf3n de Usuario"}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Datos de Autenticaci\xf3n"}),(0,t.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Token:"})," ",s?"Presente":"No disponible"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Rol (AuthContext):"})," ",r||"No definido"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Estado de carga:"})," ",i?"Cargando":"Completado"]})]})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Datos de localStorage"}),(0,t.jsx)("div",{className:"p-4 bg-white rounded-lg shadow",children:(0,t.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,t.jsx)("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(x,null,2)})})})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Usuario de Supabase"}),(0,t.jsx)("div",{className:"p-4 bg-white rounded-lg shadow",children:f?(0,t.jsx)("p",{children:"Cargando datos de usuario..."}):m?(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"ID:"})," ",m.id]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Email:"})," ",m.email]}),(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:"Metadata:"})}),(0,t.jsx)("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(m.user_metadata,null,2)})]}):(0,t.jsx)("p",{children:"No hay sesi\xf3n activa en Supabase"})})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Perfil en tabla 'users'"}),(0,t.jsx)("div",{className:"p-4 bg-white rounded-lg shadow",children:f?(0,t.jsx)("p",{children:"Cargando perfil..."}):p?(0,t.jsx)("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(p,null,2)}):(0,t.jsx)("p",{children:"No se encontr\xf3 perfil en la tabla 'users'"})})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Acciones"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsx)("button",{onClick:j,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",disabled:!m,children:"Forzar actualizaci\xf3n de rol"}),(0,t.jsx)(o(),{href:"/fix-admin",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-center",children:"Arreglar Rol Admin"}),(0,t.jsx)(o(),{href:"/admin/fix-policies",className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-center",children:"Arreglar Pol\xedticas DB"}),(0,t.jsx)(o(),{href:"/admin/create-admin",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 text-center",children:"Crear Admin"}),(0,t.jsx)(o(),{href:"/actualizar-rol",className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 text-center",children:"API Roles"})]})]})]})]})}},7896:(e,s,r)=>{"use strict";r.d(s,{A:()=>i});var t=r(7876),a=r(8230),l=r.n(a),d=r(806),n=r(4232);function i(){let{token:e,role:s,authLoading:r,logout:a}=(0,d.A)(),[i,o]=(0,n.useState)("");return(0,n.useEffect)(()=>{{o(localStorage.getItem("name")||"");let e=()=>o(localStorage.getItem("name")||"");return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}},[]),(0,n.useEffect)(()=>{o(localStorage.getItem("name")||"")},[e]),(0,t.jsx)("header",{className:"fixed top-0 inset-x-0 z-50",children:(0,t.jsxs)("nav",{className:"mx-auto max-w-6xl flex items-center justify-between p-4 md:p-6",children:[(0,t.jsx)(l(),{href:"/",className:"font-display text-xl md:text-2xl",children:"Sof\xeda & Franco"}),(0,t.jsxs)("div",{className:"flex flex-row gap-2 md:gap-4 items-center min-w-[140px] w-auto flex-nowrap",children:[!r&&"admin"!==s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l(),{href:"/rsvp",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-dusk text-white hover:opacity-90 text-sm md:text-base text-center",children:"Confirmar asistencia"}),(0,t.jsx)(l(),{href:"/menu",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-gold text-dusk hover:opacity-90 text-sm md:text-base text-center",children:"Men\xfa"})]}),!r&&("admin"===s||"admin@boda.com"===localStorage.getItem("email"))&&(0,t.jsx)(l(),{href:"/admin/dashboard",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-blue-700 text-white hover:opacity-90 text-sm md:text-base text-center",children:"Panel de control"}),!r&&e?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-dusk text-sm font-semibold truncate max-w-[100px]",title:i||s||"Usuario",children:i||s||"Usuario"}),(0,t.jsx)("button",{onClick:a,className:"px-2 py-1 rounded-full bg-blush text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Cerrar sesi\xf3n"}),("admin"===s||"prometidos"===s||"prometido"===s)&&(0,t.jsx)(l(),{href:"/debug",className:"px-2 py-1 rounded-full bg-gray-200 text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Debug"})]}):(0,t.jsx)(l(),{href:"/login",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-white border border-dusk/20 hover:bg-blush text-sm md:text-base text-center",children:"Login"})]})]})})}},8708:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/debug",function(){return r(5249)}])},9099:(e,s,r)=>{e.exports=r(6296)}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=8708)),_N_E=e.O()}]);