(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{7328:(e,s,r)=>{e.exports=r(9269)},7984:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(9307)}])},9099:(e,s,r)=>{e.exports=r(6296)},9307:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>d});var t=r(7876),o=r(4232),n=r(7328),a=r.n(n),i=r(806),l=r(2982),c=r(9099);function d(){let e=(0,c.useRouter)(),[s,r]=(0,o.useState)(""),{login:n}=(0,i.A)(),[d,u]=(0,o.useState)(!1),[m,x]=(0,o.useState)(null),[h,g]=(0,o.useState)(!1);async function p(s){s.preventDefault(),x(null),u(!0),r("");let t=new FormData(s.currentTarget),o=String(t.get("email")||""),a=String(t.get("password")||"");try{var i,c;let{data:s,error:t}=await l.N.auth.signInWithPassword({email:o,password:a});if(t||!s.session){x("Error de autenticaci\xf3n: ".concat((null==t?void 0:t.message)||"Credenciales inv\xe1lidas")),u(!1);return}r("Autenticaci\xf3n exitosa, obteniendo perfil..."),console.log("Sesi\xf3n creada:",s.session.access_token.substring(0,10)+"..."),localStorage.setItem("supabase.auth.token",JSON.stringify({currentSession:s.session}));let d=(null==(i=s.session.user.user_metadata)?void 0:i.role)||"invitado",m=(null==(c=s.session.user.user_metadata)?void 0:c.name)||"",{data:h,error:g}=await l.N.from("users").select("rol, nombre").eq("id",s.session.user.id).single();if(g&&"PGRST116"!==g.code&&console.error("Error buscando perfil:",g),h)d=h.rol||d,m=h.nombre||m,console.log("Perfil encontrado:",{rol:d,nombre:m});else{console.log("Creando perfil de usuario...");let{error:e}=await l.N.from("users").insert({id:s.session.user.id,nombre:m||o.split("@")[0]||"Usuario",rol:d});e?console.error("Error creando perfil:",e):console.log("Perfil creado exitosamente")}n(s.session.access_token,d),m&&localStorage.setItem("name",m),s.session.user.email&&localStorage.setItem("email",s.session.user.email),r("Login exitoso, redirigiendo...");let{data:{session:p}}=await l.N.auth.getSession();console.log("Verificaci\xf3n de sesi\xf3n:",p?"✅ Existe":"❌ No existe"),setTimeout(()=>{e.push("/")},1e3)}catch(e){console.error("Error en proceso de login:",e),x("Error inesperado: ".concat(e.message))}finally{u(!1)}}return(0,o.useEffect)(()=>{},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a(),{children:(0,t.jsx)("title",{children:"Iniciar Sesi\xf3n - Sof\xeda & Franco"})}),(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center p-6 bg-blush/10 bg-[url('/texture.svg')] bg-repeat",children:(0,t.jsxs)("div",{className:"w-full max-w-md overflow-hidden rounded-2xl shadow-xl",children:[(0,t.jsxs)("div",{className:"bg-dusk text-white py-6 px-8",children:[(0,t.jsx)("h1",{className:"font-display text-3xl text-center",children:"Iniciar Sesi\xf3n"}),(0,t.jsx)("p",{className:"text-center text-sm text-white/70 mt-2",children:"Boda de Sof\xeda & Franco"})]}),(0,t.jsxs)("form",{onSubmit:p,className:"p-8 bg-white space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Correo Electr\xf3nico"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),(0,t.jsx)("input",{id:"email",name:"email",type:"email",placeholder:"email@example.com",required:!0,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Contrase\xf1a"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,t.jsx)("input",{id:"password",name:"password",type:h?"text":"password",placeholder:"••••••••",required:!0,className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gold focus:border-transparent"}),(0,t.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>g(!h),children:h?(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500 hover:text-dusk",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-500 hover:text-dusk",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),(0,t.jsx)("button",{type:"submit",className:"w-full py-3 px-4 rounded-lg bg-gold text-dusk font-medium hover:bg-gold/90 transition-colors duration-200 flex items-center justify-center shadow-sm",disabled:d,children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-dusk",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Entrando..."]}):"Iniciar Sesi\xf3n"}),m&&(0,t.jsx)("div",{className:"bg-red-50 text-red-800 p-3 rounded-lg text-sm",children:m}),s&&(0,t.jsx)("div",{className:"bg-green-50 text-green-800 p-3 rounded-lg text-sm",children:s}),(0,t.jsx)("div",{className:"flex justify-end items-center",children:(0,t.jsx)("a",{href:"/register",className:"text-sm text-gold hover:text-dusk transition-colors duration-200",children:"\xbfNo tienes cuenta? Reg\xedstrate aqu\xed"})})]})]})})]})}}},e=>{e.O(0,[636,593,792],()=>e(e.s=7984)),_N_E=e.O()}]);