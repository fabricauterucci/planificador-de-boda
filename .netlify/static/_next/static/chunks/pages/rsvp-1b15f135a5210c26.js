(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[35],{4694:(e,r,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/rsvp",function(){return a(7167)}])},7167:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>c});var s=a(7876),t=a(806),o=a(4232),i=a(9099);function n(e){let{children:r}=e,a=(0,i.useRouter)(),{token:n,role:l,authLoading:c}=(0,t.A)();return((0,o.useEffect)(()=>{c||(n?"invitado"!==l&&a.push("/dashboard"):a.push("/login"))},[n,l,a,c]),c)?(0,s.jsx)("div",{children:"Cargando..."}):(0,s.jsx)(s.Fragment,{children:r})}var l=a(2982);function c(){let{token:e,role:r}=(0,t.A)(),a=(0,i.useRouter)(),c=null,d="";if(e)try{d=JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"))).email||"",c=(0,s.jsxs)("div",{className:"mb-6 text-center text-lg text-dusk font-semibold",children:["\xa1Bienvenido",d?", ".concat(d):"","! Gracias por confirmar tu asistencia."]})}catch(e){}let[u,m]=(0,o.useState)(""),[p,h]=(0,o.useState)("asistire"),[g,x]=(0,o.useState)(""),[f,v]=(0,o.useState)([]),[N,b]=(0,o.useState)(""),[w,j]=(0,o.useState)(!0),[_,y]=(0,o.useState)(!0),[E,C]=(0,o.useState)(!1);async function k(e){e.preventDefault(),m(""),j(!0);try{var r,s;let e,{data:{user:t},error:o}=await l.N.auth.getUser();if(o){console.error("Error obteniendo usuario:",o),m("Error de autenticaci\xf3n: ".concat(o.message)),j(!1);return}if(!t){m("No est\xe1s logueado"),j(!1);return}console.log("Enviando RSVP para usuario:",t.id),console.log("Estado:",E?"Actualizando existente":"Creando nuevo"),console.log("Datos:",{asistencia:p,menu:"asistire"===p?g||(null==(r=f[0])?void 0:r.nombre)||"Clasico Argentino":"",comentario:N});let i={user_id:t.id,asistencia:p,menu:"asistire"===p?g||(null==(s=f[0])?void 0:s.nombre)||"Clasico Argentino":"",comentario:N};if(E){let{data:r,error:a}=await l.N.from("rsvp").select("id").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1);a||!r||0===r.length?(console.error("Error buscando Reserva existente:",a),e=await l.N.from("rsvp").insert(i)):e=await l.N.from("rsvp").update(i).eq("id",r[0].id)}else e=await l.N.from("rsvp").insert(i);if(e.error)console.error("Error Supabase:",e.error),m("Error al enviar Reserva: ".concat(e.error.message));else{console.log("Reserva guardado con \xe9xito:",e.data),m("Reserva realizada con \xe9xito"),C(!0);let{data:r,error:s}=await l.N.from("rsvp").select("*").eq("user_id",t.id).single();s?console.error("Error al verificar Reserva:",s):console.log("Verificaci\xf3n exitosa:",r),setTimeout(()=>{a.push("/")},1500)}}catch(e){console.error("Error inesperado:",e),m("Error inesperado: ".concat(e.message))}finally{j(!1)}}return(0,o.useEffect)(()=>{!async function(){j(!0);try{var e,r;let{data:{session:a}}=await l.N.auth.getSession();if(!a){console.error("No hay sesi\xf3n activa"),j(!1);return}let{data:s}=await l.N.from("menus").select("id, nombre, descripcion").eq("activo",!0);v(s||[]);let{data:{user:t}}=await l.N.auth.getUser();if(!t){console.error("No se pudo obtener el usuario"),j(!1);return}console.log("Buscando Reserva para usuario:",t.id);let{data:o,error:i}=await l.N.from("rsvp").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(1);i&&console.error("Error buscando Reserva:",i),o&&o.length>0?(console.log("Reserva encontrada:",o[0]),h(o[0].asistencia),x(o[0].menu||s&&(null==(e=s[0])?void 0:e.nombre)||""),b(o[0].comentario||""),C(!0)):(console.log("No se encontr\xf3 Reserva para este usuario"),x(s&&(null==(r=s[0])?void 0:r.nombre)||""),C(!1))}catch(e){console.error("Error cargando datos:",e)}finally{j(!1)}}()},[]),(0,s.jsx)(n,{children:(0,s.jsx)("div",{className:"min-h-screen p-6 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"w-full max-w-xl",children:[c,(0,s.jsxs)("form",{onSubmit:k,className:"w-full p-6 rounded-2xl bg-white shadow space-y-4",children:[(0,s.jsx)("h1",{className:"font-display text-2xl",children:"Confirm\xe1 tu asistencia"}),(0,s.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"radio",name:"attending",value:"asistire",checked:"asistire"===p,onChange:()=>h("asistire"),disabled:!_})," Asistir\xe9"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"radio",name:"attending",value:"no_puedo_ir",checked:"no_puedo_ir"===p,onChange:()=>h("no_puedo_ir"),disabled:!_})," No puedo ir"]}),"asistire"===p&&(0,s.jsx)("a",{href:"/menu",target:"_blank",rel:"noopener noreferrer",className:"ml-auto px-4 py-2 rounded-full bg-gold text-dusk font-semibold text-sm shadow hover:bg-dusk hover:text-white transition",style:{marginLeft:"auto"},children:"Ver men\xfa"})]}),"asistire"===p&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("select",{name:"menu",className:"w-full border rounded-lg p-2",required:!0,value:g,onChange:e=>x(e.target.value),disabled:!_,children:f.map(e=>(0,s.jsx)("option",{value:e.nombre,children:e.nombre},e.id))}),(0,s.jsx)("input",{className:"w-full border rounded-lg p-2",name:"allergies",placeholder:"Alergias o comentarios (opcional)",value:N,onChange:e=>b(e.target.value),disabled:!_})]}),(0,s.jsx)("button",{className:"w-full py-2 rounded-lg bg-dusk text-white flex items-center justify-center",disabled:!_||w,type:"submit",children:w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Procesando..."]}):_?E?"Modificar asistencia":"Confirmar asistencia":"Edici\xf3n cerrada"}),u&&(0,s.jsx)("p",{className:"text-sm ".concat(u.includes("Error")?"text-red-600":"text-green-600"," font-medium"),children:u}),!_&&(0,s.jsx)("p",{className:"text-xs text-red-600 mt-2",children:"La edici\xf3n de asistencia y men\xfa est\xe1 cerrada (solo hasta una semana antes del evento)."})]})]})})})}},9099:(e,r,a)=>{e.exports=a(6296)}},e=>{e.O(0,[636,593,792],()=>e(e.s=4694)),_N_E=e.O()}]);