(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[983],{4387:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(7876),s=r(4232),o=r(2982),n=r(7896),i=r(9099);function d(){let[e,t]=(0,s.useState)("idle"),[r,d]=(0,s.useState)(""),l=(0,i.useRouter)();async function c(){t("loading"),d("Verificando usuario actual...");try{let{data:{user:e}}=await o.N.auth.getUser();if(!e||!e.email){t("error"),d("No hay usuario autenticado o falta email. Por favor, inicie sesi\xf3n primero.");return}d("Usuario encontrado: ".concat(e.email,". Actualizando rol a 'admin' directamente..."));let r=await fetch("/api/fix-admin-direct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email})}),a=await r.json();if(!r.ok)throw Error(a.error||a.details||"Error desconocido");localStorage.setItem("role","admin"),t("success"),d("\xa1Usuario configurado correctamente como admin! Para que todos los cambios surtan efecto completamente, debes cerrar sesi\xf3n y volver a iniciar sesi\xf3n.")}catch(e){t("error"),d("Error: ".concat(e.message)),console.error("Error completo:",e)}}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.A,{}),(0,a.jsxs)("main",{className:"pt-24 max-w-4xl mx-auto p-4",children:[(0,a.jsx)("h1",{className:"font-display text-2xl mb-6",children:"Soluci\xf3n Directa para Permisos Admin"}),(0,a.jsxs)("div",{className:"mb-8 p-4 bg-white rounded-lg shadow",children:[(0,a.jsx)("p",{className:"mb-4",children:'Esta herramienta actualizar\xe1 directamente tu usuario para tener permisos de administrador, solucionando el problema "No autorizado".'}),"idle"===e&&(0,a.jsx)("button",{onClick:c,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Solucionar Permisos Admin"}),"loading"===e&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"mb-2",children:"Procesando..."}),(0,a.jsx)("p",{className:"text-gray-600",children:r})]}),"success"===e&&(0,a.jsxs)("div",{className:"text-green-600",children:[(0,a.jsx)("p",{className:"font-bold mb-2",children:"\xa1\xc9xito!"}),(0,a.jsx)("p",{children:r}),(0,a.jsxs)("div",{className:"mt-4 flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>l.push("/dashboard"),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Ir al Dashboard"}),(0,a.jsx)("button",{onClick:()=>{o.N.auth.signOut().then(()=>{l.push("/login")})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Cerrar sesi\xf3n"})]})]}),"error"===e&&(0,a.jsxs)("div",{className:"text-red-600",children:[(0,a.jsx)("p",{className:"font-bold mb-2",children:"Error"}),(0,a.jsx)("p",{children:r}),(0,a.jsx)("button",{onClick:()=>t("idle"),className:"mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Intentar de nuevo"})]})]})]})]})}},7896:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var a=r(7876),s=r(8230),o=r.n(s),n=r(806),i=r(4232);function d(){let{token:e,role:t,authLoading:r,logout:s}=(0,n.A)(),[d,l]=(0,i.useState)("");return(0,i.useEffect)(()=>{{l(localStorage.getItem("name")||"");let e=()=>l(localStorage.getItem("name")||"");return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}},[]),(0,i.useEffect)(()=>{l(localStorage.getItem("name")||"")},[e]),(0,a.jsx)("header",{className:"fixed top-0 inset-x-0 z-50",children:(0,a.jsxs)("nav",{className:"mx-auto max-w-6xl flex items-center justify-between p-4 md:p-6",children:[(0,a.jsx)(o(),{href:"/",className:"font-display text-xl md:text-2xl",children:"Sof\xeda & Franco"}),(0,a.jsxs)("div",{className:"flex flex-row gap-2 md:gap-4 items-center min-w-[140px] w-auto flex-nowrap",children:[!r&&"admin"!==t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o(),{href:"/rsvp",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-dusk text-white hover:opacity-90 text-sm md:text-base text-center",children:"Confirmar asistencia"}),(0,a.jsx)(o(),{href:"/menu",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-gold text-dusk hover:opacity-90 text-sm md:text-base text-center",children:"Men\xfa"})]}),!r&&("admin"===t||"admin@boda.com"===localStorage.getItem("email"))&&(0,a.jsx)(o(),{href:"/admin/dashboard",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-blue-700 text-white hover:opacity-90 text-sm md:text-base text-center",children:"Panel de control"}),!r&&e?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-dusk text-sm font-semibold truncate max-w-[100px]",title:d||t||"Usuario",children:d||t||"Usuario"}),(0,a.jsx)("button",{onClick:s,className:"px-2 py-1 rounded-full bg-blush text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Cerrar sesi\xf3n"}),("admin"===t||"prometidos"===t||"prometido"===t)&&(0,a.jsx)(o(),{href:"/debug",className:"px-2 py-1 rounded-full bg-gray-200 text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Debug"})]}):(0,a.jsx)(o(),{href:"/login",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-white border border-dusk/20 hover:bg-blush text-sm md:text-base text-center",children:"Login"})]})]})})}},8330:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/fix-admin-direct",function(){return r(4387)}])},9099:(e,t,r)=>{e.exports=r(6296)}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=8330)),_N_E=e.O()}]);