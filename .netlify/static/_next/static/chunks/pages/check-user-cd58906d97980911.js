(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[516],{2332:(e,r,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/check-user",function(){return a(5288)}])},5288:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>c});var s=a(7876),o=a(4232),l=a(9099),i=a(806),d=a(2982),t=a(8230),n=a.n(t);function c(){var e,r,a;let{role:t}=(0,i.A)(),c=(0,l.useRouter)(),[u,m]=(0,o.useState)("boda@boda.com"),[h,p]=(0,o.useState)(null),[x,b]=(0,o.useState)(!1),[g,N]=(0,o.useState)(null),[f,j]=(0,o.useState)(null);async function v(){b(!0),N(null),p(null);try{let e=await fetch("/api/check-user?email=".concat(encodeURIComponent(u))),r=await e.json();if(!e.ok)throw Error(r.error||"Error al verificar usuario");p(r)}catch(e){console.error("Error:",e),N(e.message)}finally{b(!1)}}async function w(){b(!0),j(null),N(null);try{let{data:e,error:r}=await d.N.from("auth.users").select("id, email").eq("email",u).single();if(r){if("PGRST116"===r.code)throw Error("No existe usuario en auth con email ".concat(u));throw r}let a=e.id,{data:s,error:o}=await d.N.from("users").select("*").eq("id",a).maybeSingle();if(s)if("invitado"!==s.rol){let{data:e,error:r}=await d.N.from("users").update({rol:"invitado"}).eq("id",a);if(r)throw r;j("Usuario actualizado en tabla users con rol 'invitado'")}else j("El usuario ya existe en la tabla users con rol correcto");else{let{data:e,error:r}=await d.N.from("users").insert({id:a,nombre:u.split("@")[0],rol:"invitado"});if(r)throw r;j("Usuario creado en tabla users con id ".concat(a," y rol 'invitado'"))}v()}catch(e){console.error("Error al corregir usuario:",e),N(e.message)}finally{b(!1)}}return((0,o.useEffect)(()=>{"admin"!==t&&"prometidos"!==t&&c.push("/login")},[t,c]),"admin"!==t&&"prometidos"!==t)?(0,s.jsx)("div",{className:"p-8",children:"Redirigiendo..."}):(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Verificar Usuario"}),(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(n(),{href:"/admin/dashboard",className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Volver al Dashboard"})}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)("input",{type:"email",className:"border rounded p-2 flex-1",value:u,onChange:e=>m(e.target.value),placeholder:"correo@ejemplo.com"}),(0,s.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",onClick:v,disabled:x,children:x?"Verificando...":"Verificar"})]}),g&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:g}),f&&(0,s.jsx)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:f}),h&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Resultado:"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"bg-gray-100 p-4 rounded",children:[(0,s.jsx)("h3",{className:"font-bold",children:"Usuario en Auth:"}),h.authUser.data?(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:JSON.stringify(h.authUser.data,null,2)}):(0,s.jsxs)("p",{className:"text-red-600",children:["No encontrado: ",null==(e=h.authUser.error)?void 0:e.message]})]}),(0,s.jsxs)("div",{className:"bg-gray-100 p-4 rounded",children:[(0,s.jsx)("h3",{className:"font-bold",children:"Usuario en App:"}),h.appUser.data?(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:JSON.stringify(h.appUser.data,null,2)}):(0,s.jsxs)("p",{className:"text-red-600",children:["No encontrado: ",null==(r=h.appUser.error)?void 0:r.message]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-100 p-4 rounded mb-4",children:[(0,s.jsx)("h3",{className:"font-bold",children:"RSVP:"}),h.rsvp.data?(0,s.jsx)("pre",{className:"whitespace-pre-wrap text-sm",children:JSON.stringify(h.rsvp.data,null,2)}):(0,s.jsxs)("p",{className:"text-red-600",children:["No encontrado: ",null==(a=h.rsvp.error)?void 0:a.message]})]}),(0,s.jsxs)("div",{className:"bg-yellow-100 p-4 rounded border border-yellow-400",children:[(0,s.jsx)("h3",{className:"font-bold",children:"Diagn\xf3stico:"}),(0,s.jsx)("p",{children:h.dashboard.issue}),(0,s.jsx)("p",{className:"mt-2",children:h.dashboard.possibleFix}),h.appUser.data&&"invitado"===h.appUser.data.rol?(0,s.jsx)("p",{className:"mt-2 text-green-600 font-semibold",children:"âœ… El usuario est\xe1 configurado correctamente."}):(0,s.jsx)("button",{onClick:w,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",disabled:x,children:x?"Corrigiendo...":"Crear/Corregir registro de usuario"})]})]})]})]})}},9099:(e,r,a)=>{e.exports=a(6296)}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=2332)),_N_E=e.O()}]);