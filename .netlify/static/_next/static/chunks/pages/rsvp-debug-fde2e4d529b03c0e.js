(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521],{629:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>t});var s=a(7876),o=a(4232),n=a(806),i=a(2982);function t(){let{token:e,role:r}=(0,n.A)(),[a,t]=(0,o.useState)({userInfo:null,rsvpInfo:[],tables:[],loading:!0,error:null});async function l(){try{let e,{data:{user:r}}=await i.N.auth.getUser();if(!r)return alert("No hay usuario autenticado");let{data:a,error:s}=await i.N.from("rsvp").select("*").eq("user_id",r.id).single();if((e=a?await i.N.from("rsvp").update({asistencia:"asistire",menu:"Clasico Argentino",comentario:"Prueba desde debug - actualizado "+new Date().toISOString()}).eq("user_id",r.id):await i.N.from("rsvp").insert({user_id:r.id,asistencia:"asistire",menu:"Clasico Argentino",comentario:"Prueba desde debug - creado "+new Date().toISOString()})).error)throw console.error("Error en operaci\xf3n RSVP:",e.error),e.error;let{data:o,error:n}=await i.N.from("rsvp").select("*").eq("user_id",r.id).single();n?(console.error("Error al verificar RSVP:",n),alert("RSVP enviado pero no se pudo verificar: ".concat(n.message))):(console.log("Verificaci\xf3n exitosa:",o),alert("RSVP de prueba guardado correctamente")),window.location.reload()}catch(r){console.error("Error creando RSVP de prueba:",r);let e=r instanceof Error?r.message:"Error desconocido";alert("Error: ".concat(e))}}async function d(){try{alert("Esta funci\xf3n debe ejecutarse en el SQL Editor de Supabase. El SQL ha sido copiado al portapapeles."),await navigator.clipboard.writeText("\n      CREATE TABLE IF NOT EXISTS public.rsvp (\n        id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n        created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),\n        user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,\n        asistencia TEXT NOT NULL CHECK (asistencia IN ('asistire', 'no_puedo_ir')),\n        menu TEXT,\n        comentario TEXT,\n        UNIQUE(user_id)\n      );\n      ALTER TABLE public.rsvp ENABLE ROW LEVEL SECURITY;\n      CREATE POLICY \"Usuario puede ver su propio RSVP\" ON public.rsvp FOR SELECT USING (auth.uid() = user_id);\n      CREATE POLICY \"Usuario puede crear su propio RSVP\" ON public.rsvp FOR INSERT WITH CHECK (auth.uid() = user_id);\n      CREATE POLICY \"Usuario puede actualizar su propio RSVP\" ON public.rsvp FOR UPDATE USING (auth.uid() = user_id);\n      CREATE POLICY \"Admins pueden ver todos los RSVPs\" ON public.rsvp FOR SELECT USING (auth.jwt() ->> 'role' = 'admin' OR auth.jwt() ->> 'role' = 'prometidos');\n      ")}catch(r){let e=r instanceof Error?r.message:"Error desconocido";alert("Error: ".concat(e))}}return((0,o.useEffect)(()=>{!async function(){try{let{data:{user:e},error:r}=await i.N.auth.getUser();if(r)throw r;let{data:a,error:s}=await i.N.from("pg_catalog.pg_tables").select("schemaname, tablename").eq("schemaname","public").in("tablename",["users","rsvp","menus"]);s&&console.error("Error obteniendo tablas:",s);let o=[],n=null;if(e){let r=await i.N.from("rsvp").select("*").eq("user_id",e.id);o=r.data||[],n=r.error}let l=r?r.message:n?n.message:null;t({userInfo:e,rsvpInfo:o,tables:a||[],loading:!1,error:l})}catch(e){console.error("Error en debug:",e),t(r=>({...r,loading:!1,error:e instanceof Error?e.message:"Error desconocido"}))}}()},[]),a.loading)?(0,s.jsx)("div",{className:"p-8",children:"Cargando informaci\xf3n de debugging..."}):(0,s.jsxs)("div",{className:"p-8 max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Debugging RSVP"}),a.error&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,s.jsx)("h3",{className:"font-bold",children:"Error:"}),(0,s.jsx)("p",{children:a.error})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Usuario"}),a.userInfo?(0,s.jsx)("pre",{className:"bg-gray-100 p-4 rounded overflow-auto max-h-60",children:JSON.stringify(a.userInfo,null,2)}):(0,s.jsx)("p",{className:"text-red-600",children:"No hay usuario autenticado"})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"RSVP"}),a.rsvpInfo&&a.rsvpInfo.length>0?(0,s.jsx)("pre",{className:"bg-gray-100 p-4 rounded overflow-auto max-h-60",children:JSON.stringify(a.rsvpInfo,null,2)}):(0,s.jsx)("p",{className:"text-yellow-600",children:"No hay RSVP para este usuario"})]}),(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow md:col-span-2",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Tablas en la Base de Datos"}),a.tables.length>0?(0,s.jsx)("ul",{className:"grid grid-cols-3 gap-2",children:a.tables.map((e,r)=>(0,s.jsxs)("li",{className:"bg-gray-100 p-2 rounded",children:[e.schemaname,".",e.tablename]},r))}):(0,s.jsx)("p",{className:"text-yellow-600",children:"No se encontraron tablas o no tienes acceso"})]})]}),(0,s.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,s.jsx)("button",{onClick:l,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Crear RSVP de Prueba"}),(0,s.jsx)("button",{onClick:d,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Copiar SQL para Crear Tabla RSVP"}),(0,s.jsx)("a",{href:"/rsvp",className:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 inline-block",children:"Ir a RSVP"})]})]})}},7758:(e,r,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/rsvp-debug",function(){return a(629)}])}},e=>{e.O(0,[636,593,792],()=>e(e.s=7758)),_N_E=e.O()}]);