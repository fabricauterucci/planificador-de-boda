(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[899],{748:(e,r,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/fix-admin",function(){return a(9059)}])},4780:(e,r,a)=>{"use strict";a.d(r,{K:()=>s,r:()=>o});var t=a(2982);async function s(e,r){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let{data:{session:s}}=await t.N.auth.getSession(),o=null==s?void 0:s.access_token;if(!o)throw Error("No hay sesi\xf3n activa");let n=await fetch("/api/update-role",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({userId:e,nuevoRol:r})}),i=await n.json();if(!n.ok)throw Error(i.error||"Error al actualizar rol");console.log("Rol actualizado correctamente:",i);let{data:{user:l}}=await t.N.auth.getUser();return((null==l?void 0:l.id)===e||a)&&(alert("Tu rol ha sido actualizado. Debes cerrar sesi\xf3n e iniciarla nuevamente para que los cambios surtan efecto."),a&&(await t.N.auth.signOut(),window.location.href="/login")),{success:!0,data:i}}catch(e){return console.error("Error al actualizar rol:",e.message),{success:!1,error:e.message}}}async function o(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let{data:{user:a}}=await t.N.auth.getUser();if(!a)throw Error("No hay usuario autenticado");let{success:o,error:n}=await s(a.id,e,r);if(!o)throw Error(n);return r||(localStorage.setItem("role",e),alert("Tu rol ha sido actualizado en la base de datos. Para aplicar todos los cambios, cierra sesi\xf3n e inicia sesi\xf3n nuevamente.")),{success:!0}}catch(e){return console.error("Error al actualizar rol propio:",e.message),{success:!1,error:e.message}}}},7896:(e,r,a)=>{"use strict";a.d(r,{A:()=>l});var t=a(7876),s=a(8230),o=a.n(s),n=a(806),i=a(4232);function l(){let{token:e,role:r,authLoading:a,logout:s}=(0,n.A)(),[l,d]=(0,i.useState)("");return(0,i.useEffect)(()=>{{d(localStorage.getItem("name")||"");let e=()=>d(localStorage.getItem("name")||"");return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}},[]),(0,i.useEffect)(()=>{d(localStorage.getItem("name")||"")},[e]),(0,t.jsx)("header",{className:"fixed top-0 inset-x-0 z-50",children:(0,t.jsxs)("nav",{className:"mx-auto max-w-6xl flex items-center justify-between p-4 md:p-6",children:[(0,t.jsx)(o(),{href:"/",className:"font-display text-xl md:text-2xl",children:"Sof\xeda & Franco"}),(0,t.jsxs)("div",{className:"flex flex-row gap-2 md:gap-4 items-center min-w-[140px] w-auto flex-nowrap",children:[!a&&"admin"!==r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o(),{href:"/rsvp",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-dusk text-white hover:opacity-90 text-sm md:text-base text-center",children:"Confirmar asistencia"}),(0,t.jsx)(o(),{href:"/menu",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-gold text-dusk hover:opacity-90 text-sm md:text-base text-center",children:"Men\xfa"})]}),!a&&("admin"===r||"admin@boda.com"===localStorage.getItem("email"))&&(0,t.jsx)(o(),{href:"/admin/dashboard",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-blue-700 text-white hover:opacity-90 text-sm md:text-base text-center",children:"Panel de control"}),!a&&e?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-dusk text-sm font-semibold truncate max-w-[100px]",title:l||r||"Usuario",children:l||r||"Usuario"}),(0,t.jsx)("button",{onClick:s,className:"px-2 py-1 rounded-full bg-blush text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Cerrar sesi\xf3n"}),("admin"===r||"prometidos"===r||"prometido"===r)&&(0,t.jsx)(o(),{href:"/debug",className:"px-2 py-1 rounded-full bg-gray-200 text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Debug"})]}):(0,t.jsx)(o(),{href:"/login",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-white border border-dusk/20 hover:bg-blush text-sm md:text-base text-center",children:"Login"})]})]})})}},9059:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>d});var t=a(7876),s=a(4232),o=a(2982),n=a(4780),i=a(7896),l=a(9099);function d(){let[e,r]=(0,s.useState)("idle"),[a,d]=(0,s.useState)(""),c=(0,l.useRouter)();async function u(){r("loading"),d("Verificando usuario actual...");try{let{data:{user:e}}=await o.N.auth.getUser();if(!e){r("error"),d("No hay usuario autenticado. Por favor, inicie sesi\xf3n primero.");return}d("Usuario encontrado: ".concat(e.email,". Actualizando rol a 'admin'..."));let{success:a,error:t}=await (0,n.r)("admin",!1);if(!a)throw Error(t);r("success"),d("\xa1Usuario configurado correctamente como admin! Para que todos los cambios surtan efecto, debes cerrar sesi\xf3n y volver a iniciar sesi\xf3n.")}catch(e){r("error"),d("Error: ".concat(e.message)),console.error("Error completo:",e)}}return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.A,{}),(0,t.jsxs)("main",{className:"pt-24 max-w-4xl mx-auto p-4",children:[(0,t.jsx)("h1",{className:"font-display text-2xl mb-6",children:"Arreglar Rol de Administrador"}),(0,t.jsxs)("div",{className:"mb-8 p-4 bg-white rounded-lg shadow",children:[(0,t.jsx)("p",{className:"mb-4",children:"Esta herramienta te ayudar\xe1 a configurar correctamente el rol de administrador en la base de datos."}),"idle"===e&&(0,t.jsx)("button",{onClick:u,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Configurar como Admin"}),"loading"===e&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"mb-2",children:"Procesando..."}),(0,t.jsx)("p",{className:"text-gray-600",children:a})]}),"success"===e&&(0,t.jsxs)("div",{className:"text-green-600",children:[(0,t.jsx)("p",{className:"font-bold mb-2",children:"\xa1\xc9xito!"}),(0,t.jsx)("p",{children:a}),(0,t.jsxs)("div",{className:"mt-4 flex gap-4",children:[(0,t.jsx)("button",{onClick:()=>c.push("/debug"),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Ir a Depuraci\xf3n"}),(0,t.jsx)("button",{onClick:()=>{o.N.auth.signOut().then(()=>{c.push("/login")})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Cerrar sesi\xf3n"})]})]}),"error"===e&&(0,t.jsxs)("div",{className:"text-red-600",children:[(0,t.jsx)("p",{className:"font-bold mb-2",children:"Error"}),(0,t.jsx)("p",{children:a}),(0,t.jsx)("button",{onClick:()=>r("idle"),className:"mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300",children:"Intentar de nuevo"})]})]})]})]})}},9099:(e,r,a)=>{e.exports=a(6296)}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=748)),_N_E=e.O()}]);