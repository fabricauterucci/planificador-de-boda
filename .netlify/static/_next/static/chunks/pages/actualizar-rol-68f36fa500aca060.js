(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{4780:(e,a,r)=>{"use strict";r.d(a,{K:()=>s,r:()=>o});var t=r(2982);async function s(e,a){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let{data:{session:s}}=await t.N.auth.getSession(),o=null==s?void 0:s.access_token;if(!o)throw Error("No hay sesi\xf3n activa");let l=await fetch("/api/update-role",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({userId:e,nuevoRol:a})}),n=await l.json();if(!l.ok)throw Error(n.error||"Error al actualizar rol");console.log("Rol actualizado correctamente:",n);let{data:{user:i}}=await t.N.auth.getUser();return((null==i?void 0:i.id)===e||r)&&(alert("Tu rol ha sido actualizado. Debes cerrar sesi\xf3n e iniciarla nuevamente para que los cambios surtan efecto."),r&&(await t.N.auth.signOut(),window.location.href="/login")),{success:!0,data:n}}catch(e){return console.error("Error al actualizar rol:",e.message),{success:!1,error:e.message}}}async function o(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let{data:{user:r}}=await t.N.auth.getUser();if(!r)throw Error("No hay usuario autenticado");let{success:o,error:l}=await s(r.id,e,a);if(!o)throw Error(l);return a||(localStorage.setItem("role",e),alert("Tu rol ha sido actualizado en la base de datos. Para aplicar todos los cambios, cierra sesi\xf3n e inicia sesi\xf3n nuevamente.")),{success:!0}}catch(e){return console.error("Error al actualizar rol propio:",e.message),{success:!1,error:e.message}}}},5008:(e,a,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/actualizar-rol",function(){return r(7058)}])},7058:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>i});var t=r(7876),s=r(4232),o=r(4780),l=r(7896),n=r(2982);function i(){let[e,a]=(0,s.useState)(""),[r,i]=(0,s.useState)("admin"),[d,c]=(0,s.useState)("idle"),[u,m]=(0,s.useState)(""),[x,h]=(0,s.useState)(null);async function p(){try{let{data:{user:e}}=await n.N.auth.getUser();e&&(h(e),a(e.id))}catch(e){console.error("Error al obtener usuario actual:",e)}}let[b,g]=(0,s.useState)(!1);async function f(){c("loading"),m("Actualizando rol...");try{let{success:a,error:t,data:s}=await (0,o.K)(e,r,b);if(!a)throw Error(t);c("success"),m('Rol actualizado correctamente a "'.concat(r,'". ').concat(b?"Ser\xe1s redirigido a login...":"Recuerda hacer logout y login nuevamente para que los cambios surtan efecto.")),console.log("Datos de respuesta:",s)}catch(e){c("error"),m("Error: ".concat(e.message)),console.error("Error completo:",e)}}return(0,s.useState)(()=>{p()}),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.A,{}),(0,t.jsxs)("main",{className:"pt-24 max-w-4xl mx-auto p-4",children:[(0,t.jsx)("h1",{className:"font-display text-2xl mb-6",children:"Actualizar Rol de Usuario"}),(0,t.jsxs)("div",{className:"mb-8 p-4 bg-white rounded-lg shadow",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Ejemplo de Uso de la API"}),(0,t.jsx)("pre",{className:"bg-gray-100 p-3 rounded mb-4 overflow-x-auto text-xs",children:"// Importar la utilidad\nimport { actualizarRol } from '../lib/roleUtils';\n\n// Actualizar el rol de un usuario\nasync function cambiarRol() {\n  const { success, error } = await actualizarRol(\n    '8b865535-13b6-46ae-9963-70c65d15c003', \n    'admin',\n    true // Opcional: forzar logout despu\xe9s de la actualizaci\xf3n\n  );\n  \n  if (success) {\n    console.log('Rol actualizado correctamente');\n  } else {\n    console.error('Error:', error);\n  }\n}"}),x&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"font-bold mb-2",children:"Usuario actual:"}),(0,t.jsxs)("p",{children:["ID: ",x.id]}),(0,t.jsxs)("p",{children:["Email: ",x.email]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"ID de Usuario:"}),(0,t.jsx)("input",{type:"text",value:e,onChange:e=>a(e.target.value),className:"w-full p-2 border rounded",placeholder:"Ej: 8b865535-13b6-46ae-9963-70c65d15c003"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Nuevo Rol:"}),(0,t.jsxs)("select",{value:r,onChange:e=>i(e.target.value),className:"w-full p-2 border rounded",children:[(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"invitado",children:"Invitado"}),(0,t.jsx)("option",{value:"prometidos",children:"Prometidos"})]})]}),(0,t.jsxs)("div",{className:"flex items-center mb-4",children:[(0,t.jsx)("input",{type:"checkbox",id:"autoLogout",checked:b,onChange:e=>g(e.target.checked),className:"mr-2"}),(0,t.jsx)("label",{htmlFor:"autoLogout",className:"text-sm",children:"Cerrar sesi\xf3n autom\xe1ticamente despu\xe9s de actualizar"})]}),(0,t.jsx)("button",{onClick:f,disabled:"loading"===d||!e,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"loading"===d?"Actualizando...":"Actualizar Rol"}),"success"===d&&(0,t.jsx)("div",{className:"p-2 bg-green-100 border border-green-300 rounded text-green-700",children:u}),"error"===d&&(0,t.jsx)("div",{className:"p-2 bg-red-100 border border-red-300 rounded text-red-700",children:u})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow",children:[(0,t.jsx)("h2",{className:"font-bold text-xl mb-4",children:"Notas Importantes"}),(0,t.jsxs)("ul",{className:"list-disc ml-6 space-y-2",children:[(0,t.jsx)("li",{children:"Esta funci\xf3n actualiza el rol tanto en los metadatos de Auth como en la tabla 'users'."}),(0,t.jsx)("li",{children:"Utiliza un endpoint API seguro para la funci\xf3n administrativa."}),(0,t.jsx)("li",{children:"Solo los administradores pueden actualizar roles de otros usuarios."}),(0,t.jsx)("li",{children:"Si recibes errores, aseg\xfarate de que est\xe1s autenticado como administrador."})]})]})]})]})}},7896:(e,a,r)=>{"use strict";r.d(a,{A:()=>i});var t=r(7876),s=r(8230),o=r.n(s),l=r(806),n=r(4232);function i(){let{token:e,role:a,authLoading:r,logout:s}=(0,l.A)(),[i,d]=(0,n.useState)("");return(0,n.useEffect)(()=>{{d(localStorage.getItem("name")||"");let e=()=>d(localStorage.getItem("name")||"");return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}},[]),(0,n.useEffect)(()=>{d(localStorage.getItem("name")||"")},[e]),(0,t.jsx)("header",{className:"fixed top-0 inset-x-0 z-50",children:(0,t.jsxs)("nav",{className:"mx-auto max-w-6xl flex items-center justify-between p-4 md:p-6",children:[(0,t.jsx)(o(),{href:"/",className:"font-display text-xl md:text-2xl",children:"Sof\xeda & Franco"}),(0,t.jsxs)("div",{className:"flex flex-row gap-2 md:gap-4 items-center min-w-[140px] w-auto flex-nowrap",children:[!r&&"admin"!==a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o(),{href:"/rsvp",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-dusk text-white hover:opacity-90 text-sm md:text-base text-center",children:"Confirmar asistencia"}),(0,t.jsx)(o(),{href:"/menu",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-gold text-dusk hover:opacity-90 text-sm md:text-base text-center",children:"Men\xfa"})]}),!r&&("admin"===a||"admin@boda.com"===localStorage.getItem("email"))&&(0,t.jsx)(o(),{href:"/admin/dashboard",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-blue-700 text-white hover:opacity-90 text-sm md:text-base text-center",children:"Panel de control"}),!r&&e?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-dusk text-sm font-semibold truncate max-w-[100px]",title:i||a||"Usuario",children:i||a||"Usuario"}),(0,t.jsx)("button",{onClick:s,className:"px-2 py-1 rounded-full bg-blush text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Cerrar sesi\xf3n"}),("admin"===a||"prometidos"===a||"prometido"===a)&&(0,t.jsx)(o(),{href:"/debug",className:"px-2 py-1 rounded-full bg-gray-200 text-dusk border border-dusk/20 text-xs hover:bg-dusk hover:text-white transition",children:"Debug"})]}):(0,t.jsx)(o(),{href:"/login",className:"px-3 py-2 md:px-4 md:py-2 rounded-full bg-white border border-dusk/20 hover:bg-blush text-sm md:text-base text-center",children:"Login"})]})]})})}}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=5008)),_N_E=e.O()}]);